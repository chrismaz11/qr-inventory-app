import{r as u,j as c,c as F}from"./vendor-k_cuo63-.js";import{o as w}from"./onnxruntime-BPzPlLw_.js";import{e as A}from"./qrscanner-CqSVJo5u.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&g(m)}).observe(document,{childList:!0,subtree:!0});function f(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function g(r){if(r.ep)return;r.ep=!0;const i=f(r);fetch(r.href,i)}})();const D=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe"];function N(){const l=u.useRef(null),h=u.useRef(null),f=u.useRef(null),[g,r]=u.useState(null),[i,m]=u.useState(""),[x,b]=u.useState([]);u.useEffect(()=>{async function t(){const e=await w.InferenceSession.create("/model/yolov5s.onnx",{executionProviders:["wasm"]});r(e)}t()},[]),u.useEffect(()=>{if(l.current)return f.current=new A(l.current,t=>{t&&t.data!==i&&(m(t.data),j())},{returnDetailedScanResult:!0}),f.current.start(),()=>{var t;(t=f.current)==null||t.stop(),f.current=null}},[l.current,g]);async function j(){if(!l.current||!g)return;const t=l.current,e=document.createElement("canvas");e.width=640,e.height=640;const o=e.getContext("2d");o.drawImage(t,0,0,e.width,e.height);const a=o.getImageData(0,0,e.width,e.height),n=new w.Tensor("float32",S(a),[1,3,e.height,e.width]),s=await g.run({images:n}),d=I(s);b(d),R(d)}function S(t){const{data:e,width:o,height:a}=t,n=new Float32Array(o*a*3);for(let s=0;s<o*a;s++)n[s]=e[s*4]/255,n[s+o*a]=e[s*4+1]/255,n[s+2*o*a]=e[s*4+2]/255;return n}function I(t){const e=[],o=Object.keys(t)[0],a=t[o].data;for(let n=0;n<a.length;n+=6){const[s,d,p,y,v,E]=a.slice(n,n+6);v>.5&&e.push({x:s,y:d,width:p,height:y,confidence:v,label:D[Math.round(E)]||"Object"})}return e}function R(t){const e=h.current;if(!e||!l.current)return;const o=e.getContext("2d"),a=l.current;e.width=a.videoWidth,e.height=a.videoHeight,o.clearRect(0,0,e.width,e.height),o.lineWidth=2,o.font="18px Arial",o.strokeStyle="#FF0000",o.fillStyle="#FF0000",t.forEach(n=>{const s=n.x*e.width,d=n.y*e.height,p=n.width*e.width,y=n.height*e.height;o.strokeRect(s,d,p,y),o.fillText(`${n.label} (${(n.confidence*100).toFixed(0)}%)`,s,d>20?d-5:d+20)})}function O(){if(!i){alert("Scan a QR code first!");return}const t=JSON.parse(localStorage.getItem("inventory")||"{}");t[i]=x,localStorage.setItem("inventory",JSON.stringify(t)),alert("Inventory saved!")}return c.jsxs("div",{style:{position:"relative",width:640},children:[c.jsx("h1",{children:"QR Inventory + AI Detection"}),c.jsx("video",{ref:l,autoPlay:!0,muted:!0,width:640,height:480,style:{border:"1px solid black"}}),c.jsx("canvas",{ref:h,style:{position:"absolute",top:0,left:0,pointerEvents:"none",width:640,height:480}}),c.jsx("div",{style:{marginTop:10},children:c.jsx("button",{onClick:O,children:"Save Inventory"})}),c.jsxs("div",{style:{marginTop:20},children:[c.jsxs("h3",{children:["Scanned QR Code: ",i||"None"]}),c.jsx("h3",{children:"Detections:"}),c.jsx("ul",{children:x.map((t,e)=>c.jsxs("li",{children:[t.label," â€” ",(t.confidence*100).toFixed(1),"%"]},e))})]})]})}F.createRoot(document.getElementById("root")).render(c.jsx(u.StrictMode,{children:c.jsx(N,{})}));
